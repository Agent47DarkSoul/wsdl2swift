#!/usr/bin/env ruby

require 'rubygems'
require 'commander/import'
require 'wsdl2swift'
require 'wsdl/version'
require 'swift'

program :version, WSDL::VERSION
program :description, 'Swift classes generator from WSDL documents.'

command :generate do |c|
  c.syntax = 'wsdl2swift generate URL [options]'
  c.summary = 'Generate Swift classes from WSDL'
  c.description = 'Generates Swift classes based upon a WSDL file. URL can be web url or local disk path.'

  c.example 'With URL as web url', 'wsdl2swift generate http://www.webservicex.net/globalweather.asmx?WSDL'
  c.example 'With URL as local path', 'wsdl2swift generate ./globalweather.wsdl'

  c.option '--output-path PATH', String, 'Path to directory where Swift class files will be generated.'
  c.action do |args, options|
    # Do something or c.when_called Wsdl2swift::Commands::Generate
    options.default output_path: Dir.pwd

    if args.size == 1
      say("Generating swift files...")

      file = WSDL::File.new(args.first)
      generator = Swift::Generator.new(options.output_path)

      generator.generate(file)
    elsif args.size < 1
      say("Failed: URL must be provided. Use --help for usage")
    else
      say("Failed: Please provide only one url or path")
    end
  end
end

default_command :generate
